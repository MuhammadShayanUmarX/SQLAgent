<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üõ°Ô∏è SQL Agent - Simple Interface</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .container { background: white; border-radius: 15px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); margin-top: 2rem; padding: 2rem; }
        .header { text-align: center; margin-bottom: 2rem; }
        .query-box { background: #2d3748; color: white; border-radius: 10px; font-family: monospace; }
        .result-box { background: #f7fafc; border-radius: 10px; padding: 1rem; margin-top: 1rem; }
        .safe-mode { background: #48bb78; color: white; }
        .unsafe-mode { background: #f56565; color: white; }
        .sample-query { cursor: pointer; padding: 0.5rem; border: 1px solid #e2e8f0; border-radius: 5px; margin: 0.25rem; }
        .sample-query:hover { background: #edf2f7; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõ°Ô∏è SQL Agent Security Demo</h1>
            <p class="text-muted">Simple interface for testing SQL security</p>
        </div>

        <!-- Security Mode -->
        <div class="row mb-3">
            <div class="col-md-6">
                <div class="form-check">
                    <input type="radio" class="form-check-input" name="mode" id="safe" value="safe" checked>
                    <label class="form-check-label" for="safe">
                        <span class="badge safe-mode">üõ°Ô∏è SAFE MODE</span> - Only SELECT queries
                    </label>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-check">
                    <input type="radio" class="form-check-input" name="mode" id="unsafe" value="unsafe">
                    <label class="form-check-label" for="unsafe">
                        <span class="badge unsafe-mode">‚ö†Ô∏è UNSAFE MODE</span> - All operations allowed
                    </label>
                </div>
            </div>
        </div>

        <!-- Query Input -->
        <div class="mb-3">
            <label class="form-label"><strong>SQL Query:</strong></label>
            <textarea id="sqlQuery" class="form-control query-box" rows="6" placeholder="Enter your SQL query here...
Example: SELECT * FROM customers"></textarea>
        </div>

        <!-- Buttons -->
        <div class="mb-3">
            <button id="executeBtn" class="btn btn-primary">‚ñ∂Ô∏è Execute Query</button>
            <button id="clearBtn" class="btn btn-secondary">üóëÔ∏è Clear</button>
            <button id="schemaBtn" class="btn btn-info">üìã Show Schema</button>
            <span id="loading" style="display:none;">‚è≥ Loading...</span>
        </div>

        <!-- Sample Queries -->
        <div class="row mb-3">
            <div class="col-md-4">
                <h6>üü¢ Basic Queries:</h6>
                <div id="basicSamples"></div>
            </div>
            <div class="col-md-4">
                <h6>üìä Analytics:</h6>
                <div id="analyticsSamples"></div>
            </div>
            <div class="col-md-4">
                <h6>‚ö†Ô∏è Dangerous:</h6>
                <div id="dangerousSamples"></div>
            </div>
        </div>

        <!-- Results -->
        <div class="result-box">
            <h5>üìä Results:</h5>
            <div id="results">
                <p class="text-muted">Execute a query to see results here</p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Load sample queries on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadSamples();
            
            // Event listeners
            document.getElementById('executeBtn').addEventListener('click', executeQuery);
            document.getElementById('clearBtn').addEventListener('click', clearQuery);
            document.getElementById('schemaBtn').addEventListener('click', showSchema);
        });

        function loadSamples() {
            fetch('/api/samples')
                .then(response => response.json())
                .then(data => {
                    displaySamples('basicSamples', data.basic);
                    displaySamples('analyticsSamples', data.analytics);
                    displaySamples('dangerousSamples', data.dangerous);
                });
        }

        function displaySamples(containerId, samples) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            samples.forEach(sample => {
                const div = document.createElement('div');
                div.className = 'sample-query';
                div.innerHTML = `<small><strong>${sample.name}</strong></small>`;
                div.onclick = () => {
                    document.getElementById('sqlQuery').value = sample.sql;
                };
                container.appendChild(div);
            });
        }

        function executeQuery() {
            const sql = document.getElementById('sqlQuery').value.trim();
            const mode = document.querySelector('input[name="mode"]:checked').value;
            
            if (!sql) {
                showResult({ success: false, message: 'Please enter a SQL query' });
                return;
            }

            document.getElementById('loading').style.display = 'inline';
            document.getElementById('executeBtn').disabled = true;

            fetch('/api/execute', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ sql: sql, security_level: mode })
            })
            .then(response => response.json())
            .then(data => showResult(data))
            .catch(error => showResult({ success: false, message: 'Network error' }))
            .finally(() => {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('executeBtn').disabled = false;
            });
        }

        function showResult(result) {
            const resultsDiv = document.getElementById('results');
            
            if (result.success) {
                let html = `<div class="alert alert-success">‚úÖ ${result.message}</div>`;
                
                if (result.data && result.data.columns) {
                    html += '<div class="table-responsive"><table class="table table-striped table-sm">';
                    
                    // Headers
                    html += '<thead class="table-dark"><tr>';
                    result.data.columns.forEach(col => html += `<th>${col}</th>`);
                    html += '</tr></thead>';
                    
                    // Rows
                    html += '<tbody>';
                    result.data.rows.forEach(row => {
                        html += '<tr>';
                        row.forEach(cell => html += `<td>${cell !== null ? cell : '<em>NULL</em>'}</td>`);
                        html += '</tr>';
                    });
                    html += '</tbody></table></div>';
                }
                
                resultsDiv.innerHTML = html;
            } else {
                resultsDiv.innerHTML = `<div class="alert alert-danger">‚ùå ${result.message || result.error}</div>`;
            }
        }

        function clearQuery() {
            document.getElementById('sqlQuery').value = '';
            document.getElementById('results').innerHTML = '<p class="text-muted">Execute a query to see results here</p>';
        }

        function showSchema() {
            fetch('/api/schema')
                .then(response => response.json())
                .then(schema => {
                    let html = '<div class="alert alert-info"><h6>üìã Database Schema:</h6>';
                    
                    for (const [tableName, columns] of Object.entries(schema)) {
                        html += `<h6 class="mt-3">${tableName}:</h6><ul class="mb-2">`;
                        columns.forEach(col => {
                            const badges = [];
                            if (col.primary_key) badges.push('<span class="badge bg-warning">PK</span>');
                            if (col.not_null) badges.push('<span class="badge bg-info">NOT NULL</span>');
                            
                            html += `<li>${col.name} <span class="badge bg-secondary">${col.type}</span> ${badges.join(' ')}</li>`;
                        });
                        html += '</ul>';
                    }
                    
                    html += '</div>';
                    document.getElementById('results').innerHTML = html;
                });
        }
    </script>
</body>
</html>